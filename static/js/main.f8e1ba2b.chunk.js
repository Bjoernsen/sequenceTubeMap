(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{19:function(e){e.exports={BACKEND_URL:"https://api.wbeyer.com",DATA_SOURCES:[{name:"snp1kg-BRCA1",xgFile:"snp1kg-BRCA1.vg.xg",gamFile:"NA12878-BRCA1.sorted.gam",anchorTrackName:"17",useMountedPath:!1,defaultPosition:"1"},{name:"cactus",xgFile:"cactus.vg.xg",gamFile:"cactus-NA12879.sorted.gam",anchorTrackName:"ref",useMountedPath:!1,defaultPosition:"1"},{name:'vg "small" example',xgFile:"x.vg.xg",gbwtFile:"x.vg.gbwt",anchorTrackName:"x",useMountedPath:!1,defaultPosition:"1"}],vgPath:"",dataPath:"./exampleData/",internalDataPath:"./exampleData/"}},33:function(e,t,a){e.exports=a(46)},40:function(e,t,a){},46:function(e,t,a){"use strict";a.r(t);var n,r,o,s,i,c,l,d,h,p,u,f,g,m=a(1),y=a.n(m),w=a(18),v=a.n(w),b=(a(38),a(17)),E=a(24),x=a(8),S=a(9),O=a(11),k=a(10),F=a(12),C=(a(40),a(16)),N=a.n(C),I=a(20),q=a(4),P={API:"API",EXAMPLE_1:"example 1",EXAMPLE_2:"example 2",EXAMPLE_3:"example 3",EXAMPLE_4:"example 4",EXAMPLE_5:"example 5",EXAMPLE_6:"example 6"},M=a(19),L=a(21),D=a(22),A=a(5),R=(a(47),!1),T=["#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],j=["#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],B=["#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],U=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],_=["#ABCCE3","#FFCFA5","#B0DBB0","#F0AEAE","#D7C6E6","#C6ABA5","#F4CCE8","#CFCFCF","#E6E6AC","#A8E7ED"],z=[],H=[],Q=[],X=[],W=[],G=[],Y=[],J=[],V=[],Z=[],K={mergeNodesFlag:!0,transparentNodesFlag:!1,clickableNodesFlag:!1,showExonsFlag:!1,colorScheme:0,nodeWidthOption:0,showReads:!0,showSoftClips:!0,haplotypeColors:"greys",forwardReadColors:"reds",reverseReadColors:"blues",exonColors:"lightColors",hideLegendFlag:!1,colorReadsByMappingQuality:!1,mappingQualityCutoff:0},$=[],ee=[],te=[],ae=[],ne=[],re=0,oe=0,se=0;function ie(e){var t,a,n,r,o=[];for(n=G[e].sequence,t=0;t<n.length;t+=1)"-"===n[t].charAt(0)&&(r=n[t].substr(1),(-1===n.indexOf(r)||n.indexOf(r)>t)&&o.push(n[t].substr(1)));for(t=0;t<G.length;t+=1)for(n=G[t].sequence,a=0;a<n.length;a+=1)"-"!==n[a].charAt(0)?-1!==o.indexOf(n[a])&&(n[a]="-".concat(n[a])):-1!==o.indexOf(n[a].substr(1))&&(n[a]=n[a].substr(1));W.forEach(function(e){-1!==o.indexOf(e.name)&&(e.seq=e.seq.split("").reverse().join(""))})}function ce(e,t){if(K[e]!==t){K[e]=t;de();K.hideLegendFlag||Ge()}}function le(e){0!==e&&1!==e&&2!==e||K.nodeWidthOption!==e&&(K.nodeWidthOption=e,void 0!==r&&(r=A.c(n),de()))}function de(){if($=[],ee=[],te=[],ae=[],ne=[],J=[],V=[],Z=[],re=0,oe=0,se=0,f=void 0,(r=A.c(n)).selectAll("*").remove(),0!==W.length&&0!==G.length){var e;ie(0),s=JSON.parse(JSON.stringify(W)),i=JSON.parse(JSON.stringify(G)),c=JSON.parse(JSON.stringify(Y)),z=Ae(K.haplotypeColors),H=Ae(K.forwardReadColors),Q=Ae(K.reverseReadColors),X=Ae(K.exonColors),c=(e=c)?e.filter(function(e){return!e.is_secondary&&e.mapping_quality>=K.mappingQualityCutoff}):e;for(var t=i.length-1;t>=0;t-=1)i[t].hasOwnProperty("type")||(i[t].type="haplo"),i[t].hasOwnProperty("hidden")&&!0===i[t].hidden&&i.splice(t,1),i[t]&&i[t].hasOwnProperty("indexOfFirstBase")&&(f=i[t].name);if(0!==i.length){h=Ee(),ve(i),c&&K.showReads&&ve(c),tt(),K.mergeNodesFlag&&(xe(),ke(),c&&K.showReads&&ye(),function(){for(var e,t,a,n=[],r=[],o=0;o<s.length;o+=1)n.push(new Set),r.push(new Set);a=c&&K.showReads?i.concat(c):i;a.forEach(function(a){for(var o=0;o<a.sequence.length;o+=1)"-"!==a.sequence[o].charAt(0)?(o>0?(e=a.sequence[o-1],n[h.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&n[h.get(a.sequence[o])].add(e.substr(1))):"haplo"===a.type&&n[h.get(a.sequence[o])].add("None"),o<a.sequence.length-1?(e=a.sequence[o+1],r[h.get(a.sequence[o])].add(e),"-"===e.charAt(0)&&r[h.get(a.sequence[o])].add(e.substr(1))):"haplo"===a.type&&r[h.get(a.sequence[o])].add("None")):(e=a.sequence[o].substr(1),o>0?"-"===(t=a.sequence[o-1]).charAt(0)?r[h.get(e)].add(t.substr(1)):(r[h.get(e)].add(t),r[h.get(e)].add("-".concat(t))):"haplo"===a.type&&r[h.get(e)].add("None"),o<a.sequence.length-1?"-"===(t=a.sequence[o+1]).charAt(0)?n[h.get(e)].add(t.substr(1)):(n[h.get(e)].add(t),n[h.get(e)].add("-".concat(t))):"haplo"===a.type&&n[h.get(e)].add("None"))});for(var l=0;l<s.length;l+=1)r[l]=Array.from(r[l]),n[l]=Array.from(n[l]);if(c&&K.showReads){var d=s.slice();d.sort(De);var p=new Map,u=new Map;d.forEach(function(e){var t=rt(h.get(e.name),n,r);t?(p.set(e.name,p.get(t)+s[h.get(t)].sequenceLength),p.set("-"+e.name,p.get(t)+s[h.get(t)].sequenceLength),u.set(e.name,u.get(t)),u.set("-"+e.name,u.get(t))):(p.set(e.name,0),p.set("-"+e.name,0),u.set(e.name,e.name),u.set("-"+e.name,e.name))}),c.forEach(function(e){e.firstNodeOffset+=p.get(e.sequence[0]),e.finalNodeCoverLength+=p.get(e.sequence[e.sequence.length-1]);for(var t=e.sequence.length-1;t>=0;t-=1){var a="-"===e.sequence[t][0]?e.sequence[t].substr(1):e.sequence[t];rt(h.get(a),n,r)&&function(){var o=rt(h.get(a),n,r);ot(h.get(o),n,r)&&(t>0?(e.sequence.splice(t,1),e.sequenceNew[t].mismatches.forEach(function(e){e.pos+=s[h.get(o)].sequenceLength}),e.sequenceNew[t-1].mismatches=e.sequenceNew[t-1].mismatches.concat(e.sequenceNew[t].mismatches),e.sequenceNew.splice(t,1)):(e.sequence[0]=u.get(e.sequence[0]),e.sequenceNew[t].mismatches.forEach(function(t){t.pos+=p.get(e.sequenceNew[0].nodeName)}),e.sequenceNew[0].nodeName=u.get(e.sequenceNew[0].nodeName)))}()}})}for(var f=0;f<s.length;f+=1)if(ot(f,n,r)&&!rt(f,n,r))for(var g=f;ot(g,n,r);)"-"===(g=r[g][0]).charAt(0)&&(g=g.substr(1)),g=h.get(g),s[f].hasOwnProperty("sequenceLength")?s[f].sequenceLength+=s[g].sequenceLength:s[f].width+=s[g].width,s[f].seq+=s[g].seq;i.forEach(function(t){for(var a=t.sequence.length-1;a>=0;a-=1){"-"===(e=t.sequence[a]).charAt(0)&&(e=e.substr(1));var o=h.get(e);rt(o,n,r)&&t.sequence.splice(a,1)}});for(var m=s.length-1;m>=0;m-=1)rt(m,n,r)&&s.splice(m,1)}(),h=Ee(),tt(),ve(i),c&&K.showReads&&ve(c)),l=s.length,d=i.length,xe(),s.forEach(function(e){e.tracks=[]}),i.forEach(function(e){e.indexSequence.forEach(function(t){s[Math.abs(t)].tracks.push(e.id)})}),s.forEach(function(e){e.hasOwnProperty("tracks")&&(e.degree=e.tracks.length)}),R&&console.log("".concat(l," nodes.")),ke(),u=function(){var e=-1;return s.forEach(function(t){t.hasOwnProperty("order")&&t.order>e&&(e=t.order)}),e}(),function(){var e=!0;i.forEach(function(t){t.hasOwnProperty("freq")?t.width=Math.round(4*(Math.log(t.freq)+1)):(t.width=15,t.hasOwnProperty("type")&&"read"===t.type&&(t.width=4)),4!==t.width&&(e=!1)}),e&&i.forEach(function(e){e.hasOwnProperty("freq")&&(e.width=15)})}(),function(){for(var e,t,a,n,r,o,c=[],l=function(e){return((e=+e)||1/e)>=0},h=0;h<=u;h+=1){J[h]=[],c[h]=[];for(var p=0;p<d;p+=1)c[h][p]=null}i.forEach(function(i,d){t=Math.abs(i.indexSequence[0]),a=l(i.indexSequence[0]),n=s[t],i.path=[],i.path.push({order:n.order,lane:null,isForward:a,node:t}),qe(n.order,t,d,0,c),e=1;for(var h=1;h<i.sequence.length;h+=1)if(r=n,o=a,t=Math.abs(i.indexSequence[h]),a=l(i.indexSequence[h]),(n=s[t]).order>r.order){o||(i.path.push({order:r.order,lane:null,isForward:!0,node:null}),qe(r.order,null,d,e,c),e+=1);for(var p=r.order+1;p<n.order;p+=1)i.path.push({order:p,lane:null,isForward:!0,node:null}),qe(p,null,d,e,c),e+=1;a?(i.path.push({order:n.order,lane:null,isForward:!0,node:t}),qe(n.order,t,d,e,c),e+=1):(i.path.push({order:n.order,lane:null,isForward:!0,node:null}),qe(n.order,null,d,e,c),e+=1,i.path.push({order:n.order,lane:null,isForward:!1,node:t}),qe(n.order,t,d,e,c),e+=1)}else if(n.order<r.order){o&&(i.path.push({order:r.order,lane:null,isForward:!1,node:null}),qe(r.order,null,d,e,c),e+=1);for(var u=r.order-1;u>n.order;u-=1)i.path.push({order:u,lane:null,isForward:!1,node:null}),qe(u,null,d,e,c),e+=1;a?(i.path.push({order:n.order,lane:null,isForward:!1,node:null}),qe(n.order,null,d,e,c),e+=1,i.path.push({order:n.order,lane:null,isForward:!0,node:t}),qe(n.order,t,d,e,c),e+=1):(i.path.push({order:n.order,lane:null,isForward:!1,node:t}),qe(n.order,t,d,e,c),e+=1)}else a!==o?(i.path.push({order:n.order,lane:null,isForward:a,node:t}),qe(n.order,t,d,e,c),e+=1):(i.path.push({order:n.order,lane:null,isForward:!a,node:null}),qe(n.order,null,d,e,c),e+=1,i.path.push({order:n.order,lane:null,isForward:a,node:t}),qe(n.order,t,d,e,c),e+=1)});for(var f=0;f<=u;f+=1)Pe(J[f],f)}(),!0===K.showExonsFlag&&null!==g&&function(){var e,t,a={};g.forEach(function(n){for(var r=0;r<d&&i[r].name!==n.track;)r+=1;r<d&&(e=0,i[r].path.forEach(function(r){null!==r.node&&(a={},t=s[r.node].hasOwnProperty("sequenceLength")?e+s[r.node].sequenceLength-1:e+s[r.node].width-1,e>=n.start&&e<=n.end&&(a.start=0),e<n.start&&t>=n.start&&(a.start=n.start-e),t<=n.end&&t>=n.start&&(a.end=t-e,t<n.end&&(a.continue=!0)),t>n.end&&e<=n.end&&(a.end=n.end-e),a.hasOwnProperty("start")&&(a.type=n.type,a.name=n.name,r.hasOwnProperty("features")||(r.features=[]),r.features.push(a)),e=t+1)}))})}(),function(){var e=0,t=20,a=-1,n=s.slice();n.sort(De);var r=function(){for(var e=[],t=[],a=[],n=0;n<=u;n+=1)e.push(0),t.push(0);i.forEach(function(a){for(var n=1;n<a.path.length;n+=1)a.path[n].order===a.path[n-1].order&&(!0===a.path[n].isForward?e[a.path[n].order]+=1:t[a.path[n].order]+=1)}),a.push(Math.max(0,e[0]-1));for(var r=1;r<=u;r+=1)a.push(Math.max(0,e[r]-1)+Math.max(0,t[r-1]-1));return a}();n.forEach(function(n){n.hasOwnProperty("order")&&(n.order>a&&(a=n.order,e=t+10*r[n.order]),n.x=e,t=Math.max(t,e+40+n.pixelWidth))})}(),c&&K.showReads&&(!function(){p=[];for(var e=0;e<=u;e+=1)p[e]=[];var t=new Map;s.forEach(function(e){e.hasOwnProperty("order")&&e.hasOwnProperty("y")&&he(t,e.order,e.y+e.contentHeight)}),i.forEach(function(e){"haplo"===e.type&&e.path.forEach(function(a){he(t,a.order,a.y+e.width)})}),s.forEach(function(e,a){e.hasOwnProperty("order")&&!e.hasOwnProperty("y")&&(e.y=t.get(e.order)+25,e.contentHeight=0,p[e.order].push(a))})}(),ye(),ve(c),function(){(function(){var e,t,a,n,r,o=function(e){return((e=+e)||1/e)>=0};c.forEach(function(i){e=Math.abs(i.indexSequence[0]),t=o(i.indexSequence[0]),a=s[e],i.path=[],i.path.push({order:a.order,isForward:t,node:e});for(var c=1;c<i.sequence.length;c+=1)if(n=a,r=t,e=Math.abs(i.indexSequence[c]),t=o(i.indexSequence[c]),(a=s[e]).order>n.order){r||i.path.push({order:n.order,isForward:!0,node:null});for(var l=n.order+1;l<a.order;l+=1)i.path.push({order:l,isForward:!0,node:null});t?i.path.push({order:a.order,isForward:!0,node:e}):(i.path.push({order:a.order,isForward:!0,node:null}),i.path.push({order:a.order,isForward:!1,node:e}))}else if(a.order<n.order){r&&i.path.push({order:n.order,isForward:!1,node:null});for(var d=n.order-1;d>a.order;d-=1)i.path.push({order:d,isForward:!1,node:null});t?(i.path.push({order:a.order,isForward:!1,node:null}),i.path.push({order:a.order,isForward:!0,node:e})):i.path.push({order:a.order,isForward:!1,node:e})}else t!==r?i.path.push({order:a.order,isForward:t,node:e}):(i.path.push({order:a.order,isForward:!t,node:null}),i.path.push({order:a.order,isForward:t,node:e}))})})(),s.forEach(function(e){e.incomingReads=[],e.outgoingReads=[],e.internalReads=[]}),c.forEach(function(e,t){e.width=7,1===e.path.length?s[e.path[0].node].internalReads.push(t):e.path.forEach(function(a,n){0===n?s[e.path[0].node].outgoingReads.push([t,n]):null!==e.path[n].node&&s[e.path[n].node].incomingReads.push([t,n])})});var e=s.slice();e.sort(De),e.forEach(function(e){e.incomingReads.sort(ge);var t=e.y+e.contentHeight,a=new Map;e.incomingReads.forEach(function(n){c[n[0]].path[n[1]].y=t,pe(a,c[n[0]],n[1],t,e),t+=7});var n=t;e.outgoingReads.sort(fe);var r=new Map;t=e.y+e.contentHeight,e.outgoingReads.forEach(function(o){c[o[0]].path[o[1]].y=t,r.set(t,c[o[0]].firstNodeOffset),!a.has(t)||a.get(t)+1<c[o[0]].firstNodeOffset?(t+=7,n=Math.max(n,t)):(a.set(t,0),e.incomingReads.forEach(function(n){var r=c[n[0]],o=r.path[n[1]];o.y>=t&&(o.y+=7,pe(a,r,n[1],o.y,e))}),t+=7,n+=7)}),e.internalReads.sort(me),e.internalReads.forEach(function(o){var s=c[o];for(t=e.y+e.contentHeight;s.firstNodeOffset<a.get(t)+2||s.finalNodeCoverLength>r.get(t)-3;)t+=7;s.path[0].y=t,a.set(t,s.finalNodeCoverLength),n=Math.max(n,t)});var o=n-e.y-e.contentHeight;e.contentHeight+=o,function(e,t){e.hasOwnProperty("order")&&(J[e.order].forEach(function(a){if(null!==a.node){var n=s[a.node];n!==e&&n.y>e.y&&(n.y+=t,a.tracks.forEach(function(e){i[e.trackID].path[e.segmentID].y+=t}))}else a.tracks.forEach(function(a){i[a.trackID].path[a.segmentID].y>=e.y&&(i[a.trackID].path[a.segmentID].y+=t)})}),p[e.order].length>0&&p[e.order].forEach(function(a){s[a]!==e&&s[a].y>e.y&&(s[a].y+=t)}))}(e,o)});var t=function(){for(var e=[],t=0;t<=u;t+=1)e.push(0);return s.forEach(function(t){e[t.order]=Math.max(e[t.order],t.y+t.contentHeight+20)}),i.forEach(function(t){t.path.forEach(function(a){e[a.order]=Math.max(e[a.order],a.y+t.width)})}),e}(),a=[];c.forEach(function(e,t){e.path.forEach(function(e,n){e.hasOwnProperty("y")||a.push({readIndex:t,pathIndex:n,previousY:c[t].path[n-1].y})})}),a.sort(ue),a.forEach(function(e){var a=c[e.readIndex].path[e.pathIndex];a.y=t[a.order],t[a.order]+=c[e.readIndex].width}),R&&(console.log("Reads:"),console.log(c))}(),i=i.concat(c)),function(){for(var e,t,a,n,r,o,c,l,d=0;d<=u;d+=1)V.push(0),Z.push(0);var h=[],p=[];s.forEach(function(e){e.hasOwnProperty("order")&&(h[e.order]=e.x,void 0===p[e.order]?p[e.order]=e.x+e.pixelWidth:p[e.order]=Math.max(p[e.order],e.x+e.pixelWidth))}),i.forEach(function(i){r=Re(i,o="plain"),a=i.path[0].y,e="read"!==i.type?"-"===i.sequence[0].charAt(0)?p[i.path[0].order]+20:h[i.path[0].order]-20:function(e){var t=s[e.path[0].node];if(e.path[0].isForward)return Te(t,e.firstNodeOffset);return Te(t,t.sequenceLength-e.firstNodeOffset)}(i);for(var d=0;d<i.path.length;d+=1)i.path[d].y===a?i.path[d].hasOwnProperty("features")&&(l=d>0&&i.path[d-1].order===i.path[d].order,c=je(i.path[d],h[i.path[d].order],p[i.path[d].order],o,i,e,a,r,l),o=c.highlight,e=c.xStart):((t=i.path[d-1].isForward?p[i.path[d-1].order]:h[i.path[d-1].order])!==e&&(r=Re(i,o),$.push({xStart:Math.min(e,t),yStart:a,xEnd:Math.max(e,t),yEnd:a+i.width-1,color:r,id:i.id,type:i.type})),i.path[d].order-1===i.path[d-1].order?(e=t,t=h[i.path[d].order],n=i.path[d].y,r=Re(i,o),ee.push({xStart:e,yStart:a,xEnd:t+1,yEnd:n,width:i.width,color:r,laneChange:Math.abs(i.path[d].lane-i.path[d-1].lane),id:i.id,type:i.type}),e=t,a=n):i.path[d].order+1===i.path[d-1].order?(e=t,t=p[i.path[d].order],n=i.path[d].y,r=Re(i,o),ee.push({xStart:e+1,yStart:a,xEnd:t,yEnd:n,width:i.width,color:r,laneChange:Math.abs(i.path[d].lane-i.path[d-1].lane),id:i.id,type:i.type}),e=t,a=n):i.path[d-1].isForward?(n=i.path[d].y,Be(t,a,n,i.width,r,i.id,i.path[d].order,i.type),e=p[i.path[d].order],a=i.path[d].y):(n=i.path[d].y,Ue(t,a,n,i.width,r,i.id,i.path[d].order,i.type),e=h[i.path[d].order],a=i.path[d].y),i.path[d].hasOwnProperty("features")&&(l=i.path[d-1].order===i.path[d].order,c=je(i.path[d],h[i.path[d].order],p[i.path[d].order],o,i,e,a,r,l),o=c.highlight,e=c.xStart));t="read"!==i.type?i.path[i.path.length-1].isForward?p[i.path[i.path.length-1].order]+20:h[i.path[i.path.length-1].order]-20:function(e){var t=s[e.path[e.path.length-1].node];if(e.path[e.path.length-1].isForward)return Te(t,e.finalNodeCoverLength);return Te(t,t.sequenceLength-e.finalNodeCoverLength)}(i),$.push({xStart:Math.min(e,t),yStart:a,xEnd:Math.max(e,t),yEnd:a+i.width-1,color:r,id:i.id,type:i.type})})}(),R&&(console.log("Tracks:"),console.log(i),console.log("Nodes:"),console.log(s),console.log("Lane assignment:"),console.log(J)),se=-99,oe=99,re=-99,s.forEach(function(e){e.hasOwnProperty("x")&&(se=Math.max(se,e.x+20+e.pixelWidth)),e.hasOwnProperty("y")&&(oe=Math.min(oe,e.y-10),re=Math.max(re,e.y+e.contentHeight+10))}),i.forEach(function(e){e.path.forEach(function(t){re=Math.max(re,t.y+e.width),oe=Math.min(oe,t.y)})}),function(){r.attr("height",re-oe+50),r.attr("width",document.getElementById(n.substring(1)).parentNode.offsetWidth);var e=Math.min(1,document.getElementById(n.substring(1)).parentNode.offsetWidth/(se+10));o=A.e().scaleExtent([e,8]).translateExtent([[-1,oe-25],[se+2,re+25]]).on("zoom",function(){var e=A.a.transform;e.y=(25-oe)*e.k,r.attr("transform",e);var t=A.c(n);t.attr("height",(re-oe+50)*A.a.transform.k),t.attr("width",document.getElementById("tubeMapSVG").clientWidth)}),r=r.call(o).on("dblclick.zoom",null).append("g");var t=document.getElementById(n.substring(1)).parentNode.offsetWidth,a=se+10<t?(t-se-10)/2:0;A.c(n).call(o.transform,A.f.translate(a,25-oe))}(),function(){var e=r.append("defs"),t=e.append("pattern").attrs({id:"patternA",width:"7",height:"7",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"});t.append("rect").attrs({x:"0",y:"0",width:"7",height:"7",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"3",height:"3",fill:"#505050"}),t.append("rect").attrs({x:"0",y:"4",width:"3",height:"3",fill:"#505050"}),t.append("rect").attrs({x:"4",y:"0",width:"3",height:"3",fill:"#505050"}),t.append("rect").attrs({x:"4",y:"4",width:"3",height:"3",fill:"#505050"}),(t=e.append("pattern").attrs({id:"patternB",width:"8",height:"8",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"8",height:"8",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attrs({x:"0",y:"5",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attrs({x:"5",y:"0",width:"3",height:"3",fill:"#1f77b4"}),t.append("rect").attrs({x:"5",y:"5",width:"3",height:"3",fill:"#1f77b4"}),(t=e.append("pattern").attrs({id:"plaid0",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#1f77b4"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#1f77b4"}),(t=e.append("pattern").attrs({id:"plaid1",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#ff7f0e"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#ff7f0e"}),(t=e.append("pattern").attrs({id:"plaid2",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#2ca02c"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#2ca02c"}),(t=e.append("pattern").attrs({id:"plaid3",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#d62728"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#d62728"}),(t=e.append("pattern").attrs({id:"plaid4",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#9467bd"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#9467bd"}),(t=e.append("pattern").attrs({id:"plaid5",width:"6",height:"6",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"})).append("rect").attrs({x:"0",y:"0",width:"6",height:"6",fill:"#FFFFFF"}),t.append("rect").attrs({x:"0",y:"0",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attrs({x:"0",y:"4",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attrs({x:"4",y:"0",width:"2",height:"2",fill:"#8c564b"}),t.append("rect").attrs({x:"4",y:"4",width:"2",height:"2",fill:"#8c564b"})}(),Qe($),We(),_e(te,ae),Qe(ne),Qe($,"read"),We("read");var a=function(e){var t,a=e.slice(0);for(t=a.length-1;t>=0;t-=1)a[t].hasOwnProperty("x")||a.splice(t,1);return a}(s);return _e(te,ae,"read"),function(e){var t,a;e.forEach(function(e){e.d="M ".concat(e.x-9," ").concat(e.y," Q ").concat(e.x-9," ").concat(e.y-9," ").concat(e.x," ").concat(e.y-9),t=e.x,a=e.y-9,e.width>1&&(t+=e.pixelWidth,e.d+=" L ".concat(t," ").concat(a)),e.d+=" Q ".concat(t+9," ").concat(a," ").concat(t+9," ").concat(a+9),t+=9,a+=9,e.contentHeight>0&&(a+=e.contentHeight-0,e.d+=" L ".concat(t," ").concat(a)),e.d+=" Q ".concat(t," ").concat(a+9," ").concat(t-9," ").concat(a+9),t-=9,a+=9,e.width>1&&(t-=e.pixelWidth,e.d+=" L ".concat(t," ").concat(a)),e.d+=" Q ".concat(t-9," ").concat(a," ").concat(t-9," ").concat(a-9),t-=9,a-=9,e.contentHeight>0&&(a-=e.contentHeight-0,e.d+=" L ".concat(t," ").concat(a))}),r.selectAll(".node").data(e).enter().append("path").attr("id",function(e){return e.name}).attr("d",function(e){return e.d}).on("mouseover",Je).on("mouseout",Ze).on("dblclick",$e).style("fill",K.transparentNodesFlag?"none":"#fff").style("fill-opacity",K.showExonsFlag?"0.4":"0.6").style("stroke","black").style("stroke-width","2px").append("svg:title").text(function(e){return e.name})}(a),0===K.nodeWidthOption&&function(e){0===K.nodeWidthOption&&r.selectAll("text").data(e).enter().append("text").attr("x",function(e){return e.x-4}).attr("y",function(e){return e.y+4}).text(function(e){return e.seq}).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none")}(a),void 0!==f&&function(){var e=0;for(;i[e].name!==f;)e+=1;var t=i[e];r.append("line").attr("x1",0).attr("y1",oe-10).attr("x2",se).attr("y2",oe-10).attr("stroke-width",1).attr("stroke","black");var a=100;0===K.nodeWidthOption&&(a=20);var n=t.indexOfFirstBase,o=!1,c=-100;if(0!==K.nodeWidthOption){var l=s[t.indexSequence[0]];c=Te(l,0),ze(n,c),o=!0}t.indexSequence.forEach(function(e){for(var t=s[e],r=Math.ceil(n/a)*a;r<n+t.sequenceLength;){var i=Te(t,r-n);c+80<=i&&(ze(r,i),o=!0,c=i),r+=a}n+=s[e].sequenceLength}),o||ze(t.indexOfFirstBase,s[t.indexSequence[0]].x-4)}(),0===K.nodeWidthOption&&i.forEach(function(e,t){"read"===e.type&&e.sequenceNew.forEach(function(t,a){t.mismatches.forEach(function(n){for(var o="-"===t.nodeName[0]?t.nodeName.substr(1):t.nodeName,i=h.get(o),c=s[i],l=Te(c,n.pos),d=a;e.path[d].node!==i;)d+=1;var p=e.path[d].y;if("insertion"===n.type)!K.showSoftClips&&(n.pos===e.firstNodeOffset&&0===a||n.pos===e.finalNodeCoverLength&&a===e.sequenceNew.length-1)||function(e,t,a,n){r.append("text").attr("x",e).attr("y",t).text("*").attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).on("mouseover",st).on("mouseout",lt).append("svg:title").text(a)}(l-3,p+7,n.seq,c.y);else if("deletion"===n.type){var u=Te(c,n.pos+n.length);!function(e,t,a,n){r.append("line").attr("x1",e).attr("y1",a-1).attr("x2",t).attr("y2",a-1).attr("stroke-width",7).attr("stroke","grey").attr("nodeY",n).on("mouseover",it).on("mouseout",dt)}(l,u,p+4,c.y)}else if("substitution"===n.type){var f=Te(c,n.pos+n.seq.length);!function(e,t,a,n,o){r.append("text").attr("x",e).attr("y",a).text(o).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").attr("nodeY",n).attr("rightX",t).on("mouseover",ct).on("mouseout",ht)}(l+1,f,p+7,c.y,n.seq)}})})}),R&&(console.log("number of tracks: ".concat(d)),console.log("number of nodes: ".concat(l))),i}}}function he(e,t,a){e.has(t)?e.set(t,Math.max(e.get(t),a)):e.set(t,a)}function pe(e,t,a,n,r){a===t.path.length-1?e.set(n,t.finalNodeCoverLength):e.set(n,r.sequenceLength)}function ue(e,t){var a=c[e.readIndex].path[e.pathIndex],n=c[t.readIndex].path[t.pathIndex];return a.order===n.order?e.previousY-t.previousY:a.order-n.order}function fe(e,t){for(var a=e[1],n=t[1],r=s[c[e[0]].path[a].node],o=s[c[t[0]].path[n].node];null!==r&&null!==o&&r===o;){if(a<c[e[0]].path.length-1){for(a+=1;null===c[e[0]].path[a].node;)a+=1;r=s[c[e[0]].path[a].node]}else r=null;if(n<c[t[0]].path.length-1){for(n+=1;null===c[t[0]].path[n].node;)n+=1;o=s[c[t[0]].path[n].node]}else o=null}if(null!==r)return null!==o?De(r,o):1;if(null!==o)return-1;var i=c[e[0]].firstNodeOffset-c[t[0]].firstNodeOffset;return 0!==i?i:c[e[0]].finalNodeCoverLength-c[t[0]].finalNodeCoverLength}function ge(e,t){if(0===e[1])return-1;if(0===t[1])return 1;var a=c[e[0]].path[e[1]-1],n=c[t[0]].path[t[1]-1];return a.hasOwnProperty("y")?n.hasOwnProperty("y")?a.y-n.y:-1:n.hasOwnProperty("y")?1:ge([e[0],e[1]-1],[t[0],t[1]-1])}function me(e,t){var a=c[e],n=c[t];return a.firstNodeOffset<n.firstNodeOffset?-1:a.firstNodeOffset>n.firstNodeOffset?1:a.finalNodeCoverLength<n.finalNodeCoverLength?-1:a.finalNodeCoverLength>n.finalNodeCoverLength?1:0}function ye(){c.forEach(function(e){for(var t=0;t<e.sequence.length&&"-"===e.sequence[t].charAt(0);)t+=1;if(t===e.sequence.length){e.is_reverse=!0,e.sequence=e.sequence.reverse();for(var a=0;a<e.sequence.length;a+=1)e.sequence[a]=e.sequence[a].substr(1);e.sequenceNew=e.sequenceNew.reverse();for(var n=function(t){e.sequenceNew[t].nodeName=e.sequenceNew[t].nodeName.substr(1);var a=s[h.get(e.sequenceNew[t].nodeName)].width;e.sequenceNew[t].mismatches.forEach(function(e){"insertion"===e.type?(e.pos=a-e.pos,e.seq=we(e.seq)):"deletion"===e.type?e.pos=a-e.pos-e.length:"substitution"===e.type&&(e.pos=a-e.pos-e.seq.length,e.seq=we(e.seq)),e.hasOwnProperty("seq")&&(e.seq=e.seq.split("").reverse().join(""))})},r=0;r<e.sequenceNew.length;r+=1)n(r);var o=e.firstNodeOffset,i=s[h.get(e.sequence[0])].sequenceLength;e.firstNodeOffset=i-e.finalNodeCoverLength,i=s[h.get(e.sequence[e.sequence.length-1])].sequenceLength,e.finalNodeCoverLength=i-o}})}function we(e){for(var t="",a=e.length-1;a>=0;a-=1)switch(e.charAt(a)){case"A":t+="T";break;case"T":t+="A";break;case"C":t+="G";break;case"G":t+="C";break;default:t+="N"}return t}function ve(e){e.forEach(function(e){e.indexSequence=[],e.sequence.forEach(function(t){"-"===t.charAt(0)?e.indexSequence.push(-h.get(t.substr(1))):e.indexSequence.push(h.get(t))})})}function be(e){var t=Math.min(1,document.getElementById(n.substring(1)).parentNode.offsetWidth/(se+10)),a=document.getElementById(n.substring(1)).parentElement.clientWidth,r=A.g(A.c(n).node()),s=Math.min(8,Math.max(r.k*e,t)),i=a/2-(a/2-r.x)*s/r.k;i=Math.min(i,1*s),i=Math.max(i,a-(se+2)*s);var c=(25-oe)*s;A.c(n).transition().duration(750).call(o.transform,A.f.translate(i,c).scale(s))}function Ee(){return h=new Map,s.forEach(function(e,t){h.set(e.name,t)}),h}function xe(){var e,t;s.forEach(function(e){e.successors=[],e.predecessors=[]}),i.forEach(function(a){for(var n=0;n<a.indexSequence.length-1;n+=1)e=Math.abs(a.indexSequence[n]),t=Math.abs(a.indexSequence[n+1]),-1===s[e].successors.indexOf(t)&&s[e].successors.push(t),-1===s[t].predecessors.indexOf(e)&&s[t].predecessors.push(e)}),c&&K.showReads&&c.forEach(function(a){for(var n=0;n<a.indexSequence.length-1;n+=1)e=Math.abs(a.indexSequence[n]),t=Math.abs(a.indexSequence[n+1]),-1===s[e].successors.indexOf(t)&&s[e].successors.push(t),-1===s[t].predecessors.indexOf(e)&&s[t].predecessors.push(e)})}function Se(e){var t,a=0,n=0,r=0;e.forEach(function(e){e<0?((t=s[Math.abs(e)]).hasOwnProperty("order")||(t.order=n),t.order<r&&(r=t.order),a=t.order,n=t.order-1):((t=s[e]).hasOwnProperty("order")||(t.order=a),a=t.order+1,n=t.order)}),r<0&&Ne(-r)}function Oe(e){for(var t,a,n,r=0,o=0;r<e.length&&!s[Math.abs(e[r])].hasOwnProperty("order");)r+=1;if(r>=e.length)return null;e[r]>=0?(t=s[e[r]].order-1,n=-1):(t=s[-e[r]].order+1,n=1);for(var i=r-1;i>=0;i-=1)(a=s[Math.abs(e[i])]).hasOwnProperty("order")||(a.order=t,o=Math.min(o,t),t+=n);return o<0&&Ne(-o),r}function ke(){var e,t,a,n,r,o,l=0;o=c&&K.showReads?i.concat(c):i,s.forEach(function(e){delete e.order}),Se(i[0].indexSequence);for(var d=1;d<o.length;d+=1)if(R&&console.log("generating order for track ".concat(d+1)),null!==(n=Oe(o[d].indexSequence)))for(e=Ce(o[d].indexSequence);n<e.length;){for(r=n,n+=1;n<e.length&&!s[e[n]].hasOwnProperty("order");)n+=1;if(n<e.length){t=s[e[r]].order+1;for(var h=r+1;h<n;h+=1)s[e[h]].order=t,t+=1;if(s[e[n]].order>s[e[r]].order)s[e[n]].order<t&&Ie(e[n],e[n-1],t);else if(o[d].indexSequence[n]>=0&&!Fe(e[n],e[r]))Ie(e[n],e[n-1],t);else if(o[d].sequence[r]<0||s[e[r+1]].degree<2&&s[e[n]].order<s[e[r]].order){t=s[e[r]].order-1;for(var p=r+1;p<n;p+=1)s[e[p]].order=t,t-=1}}else if(o[d].sequence[r]>=0){t=s[e[r]].order+1;for(var u=r+1;u<e.length;u+=1)(a=s[e[u]]).hasOwnProperty("order")||(a.order=t,t+=1)}else{t=s[e[r]].order-1;for(var f=r+1;f<e.length;f+=1)(a=s[e[f]]).hasOwnProperty("order")||(a.order=t,l=Math.min(l,t),t-=1)}}else"haplo"===o[d].type?Se(o[d].indexSequence):(o.splice(d,1),c.splice(d-i.length,1),d-=1);l<0&&Ne(-l)}function Fe(e,t){var a=new Array(l).fill(!1),n=[];for(n.push(e),a[e]=!0;n.length>0;){var r=n.pop();if(r===t)return!0;for(var o=0;o<s[r].successors.length;o+=1){var i=s[r].successors[o];a[i]||(a[i]=!0,n.push(i))}}return!1}function Ce(e){for(var t=[],a=0;a<e.length;a+=1)e[a]>=0?t.push(e[a]):t.push(-e[a]);return t}function Ne(e){s.forEach(function(t){t.hasOwnProperty("order")&&(t.order+=e)})}function Ie(e,t,a){var n=new Map,r=[];r.push([e,a]);for(var o=function(){var a=r.shift(),o=a[0],i=a[1];s[o].hasOwnProperty("order")&&s[o].order<i&&(!n.has(o)||n.get(o)<i)&&(n.set(o,i),s[o].successors.forEach(function(e){s[e].order>s[o].order&&e!==t&&r.push([e,i+1])}),o!==e&&s[o].predecessors.forEach(function(e){s[e].order>o.order&&e!==t&&r.push([e,i+1])}))};r.length>0;)o();n.forEach(function(e,t){s[t].order=e})}function qe(e,t,a,n,r){var o=r[e][a];if(null===t)J[e].push({type:"single",node:null,tracks:[{trackID:a,segmentID:n,compareToFromSame:o}]}),r[e][a]=J[e][J[e].length-1].tracks[0];else{for(var s=0;s<J[e].length;s+=1)if(J[e][s].node===t)return J[e][s].type="multiple",J[e][s].tracks.push({trackID:a,segmentID:n,compareToFromSame:o}),void(r[e][a]=J[e][s].tracks[J[e][s].tracks.length-1]);J[e].push({type:"single",node:t,tracks:[{trackID:a,segmentID:n,compareToFromSame:o}]}),r[e][a]=J[e][J[e].length-1].tracks[0]}}function Pe(e,t){var a=0,n=new Set,r=20,o=!1,c=-1;!function(e,t){var a;e.forEach(function(e){e.idealLane=0,e.tracks.forEach(function(n){if(0===n.segmentID)n.idealLane=n.trackID,n.idealY=null;else if(i[n.trackID].path[n.segmentID-1].order===t-1)n.idealLane=i[n.trackID].path[n.segmentID-1].lane,n.idealY=i[n.trackID].path[n.segmentID-1].y;else if(n.segmentID<i[n.trackID].path.length-1&&i[n.trackID].path[n.segmentID+1].order===t-1)n.idealLane=i[n.trackID].path[n.segmentID+1].lane,n.idealY=i[n.trackID].path[n.segmentID+1].y;else{for(a=n.segmentID-1;a>=0&&i[n.trackID].path[a].order!==t-1;)a-=1;a<0?(n.idealLane=n.trackID,n.idealY=null):(n.idealLane=i[n.trackID].path[a].lane,n.idealY=i[n.trackID].path[a].y)}e.idealLane+=n.idealLane}),e.idealLane/=e.tracks.length})}(e,t),e.sort(Le),e.forEach(function(e){null!==e.node?(s[e.node].topLane=a,o&&(r-=10),s[e.node].y=r,s[e.node].contentHeight=0,o=!1):(o?r-=25:r>20&&(r-=10),o=!0),e.tracks.sort(Le),e.tracks.forEach(function(t){t.lane=a,t.trackID===c&&null===e.node&&o&&(r+=10),i[t.trackID].path[t.segmentID].lane=a,i[t.trackID].path[t.segmentID].y=r,null!==t.idealY&&n.add(t.idealY-r),a+=1,r+=i[t.trackID].width,null!==e.node&&(s[e.node].contentHeight+=i[t.trackID].width),c=t.trackID}),r+=25}),function(e,t){var a=0,n=Number.MAX_SAFE_INTEGER;t.forEach(function(t){Me(e,t)<n&&(n=Me(e,t),a=t)}),e.forEach(function(e){null!==e.node&&(s[e.node].y+=a),e.tracks.forEach(function(e){i[e.trackID].path[e.segmentID].y+=a})})}(e,n)}function Me(e,t){var a=0;return e.forEach(function(e){e.tracks.forEach(function(e){null!==e.idealY&&"read"!==i[e.trackID].type&&(a+=Math.abs(e.idealY-t-i[e.trackID].path[e.segmentID].y)*i[e.trackID].width)})}),a}function Le(e,t){return e.hasOwnProperty("idealLane")?t.hasOwnProperty("idealLane")?e.idealLane<t.idealLane?-1:e.idealLane>t.idealLane?1:0:-1:t.hasOwnProperty("idealLane")?1:0}function De(e,t){if(null===e)return null===t?0:-1;if(null===t)return 1;if(e.hasOwnProperty("order")){if(t.hasOwnProperty("order")){if(e.order<t.order)return-1;if(e.order>t.order)return 1;if(e.hasOwnProperty("y")&&t.hasOwnProperty("y")){if(e.y<t.y)return-1;if(e.y>t.y)return 1}return 0}return-1}return t.hasOwnProperty("order")?1:0}function Ae(e){switch(e){case"plainColors":return U;case"reds":return B;case"blues":return j;case"greys":return T;case"lightColors":return _;default:return T}}function Re(e,t){return"undefined"===typeof t&&(t="plain"),e.hasOwnProperty("type")&&"read"===e.type?K.colorReadsByMappingQuality?A.b(Math.min(60,e.mapping_quality)/60):e.hasOwnProperty("is_reverse")&&!0===e.is_reverse?Q[e.id%Q.length]:H[e.id%H.length]:!1===K.showExonsFlag||"plain"!==t?z[e.id%z.length]:X[e.id%X.length]}function Te(e,t){if(t>e.sequenceLength)return null;var a=e.x-4,n=e.x+e.pixelWidth+4;return a+t/e.sequenceLength*(n-a)}function je(e,t,a,n,r,o,i,c,l){var d,h,p,u,f,g=n;return t-=8,a+=8,d=s[e.node].hasOwnProperty("sequenceLength")?s[e.node].sequenceLength:s[e.node].width,e.features.sort(function(e,t){return e.start-t.start}),e.features.forEach(function(n){g!==n.type&&(h=Re(r,g),!0===e.isForward?(u=t+Math.round(n.start*(a-t+1)/d),l&&u<t+8&&(f=t+Math.round((n.end+1)*(a-t+1)/d)-1,p=Re(r,n.type),ne.push({xStart:u,yStart:i,xEnd:f,yEnd:i+r.width-1,color:p,id:r.id,type:r.type})),u>o+1&&ne.push({xStart:o,yStart:i,xEnd:u-1,yEnd:i+r.width-1,color:h,id:r.id,type:r.type})):(u=a-Math.round(n.start*(a-t+1)/d),l&&u>a-8&&(f=a-Math.round((n.end+1)*(a-t+1)/d)-1,p=Re(r,n.type),ne.push({xStart:f,yStart:i,xEnd:u,yEnd:i+r.width-1,color:p,id:r.id,type:r.type})),o>u+1&&ne.push({xStart:u+1,yStart:i,xEnd:o,yEnd:i+r.width-1,color:h,id:r.id,type:r.type})),o=u,g=n.type),(n.end<d-1||!n.hasOwnProperty("continue"))&&(h=Re(r,g),!0===e.isForward?(f=t+Math.round((n.end+1)*(a-t+1)/d)-1,ne.push({xStart:o,yStart:i,xEnd:f,yEnd:i+r.width-1,color:h,id:r.id,type:r.type})):(f=a-Math.round((n.end+1)*(a-t+1)/d)-1,ne.push({xStart:f,yStart:i,xEnd:o,yEnd:i+r.width-1,color:h,id:r.id,type:r.type})),o=f+1,g="plain")}),{xStart:o,highlight:g}}function Be(e,t,a,n,r,o,s,i){e+=10*Z[s];var c=Math.min(t,a),l=Math.max(t,a);ae.push({xStart:e-10*Z[s],yStart:t,xEnd:e+5,yEnd:t+n-1,color:r,id:o,type:i}),ae.push({xStart:e+5+7,yStart:c+n+7-1,xEnd:e+5+7+Math.min(7,n)-1,yEnd:l-7+1,color:r,id:o,type:i}),ae.push({xStart:e-10*Z[s],yStart:a,xEnd:e+5,yEnd:a+n-1,color:r,id:o,type:i});var d="M ".concat(e+5," ").concat(l);d+=" Q ".concat(e+5+7," ").concat(l," ").concat(e+5+7," ").concat(l-7),d+=" H ".concat(e+5+7+Math.min(7,n)),d+=" Q ".concat(e+5+7+Math.min(7,n)," ").concat(l+n," ").concat(e+5," ").concat(l+n),d+=" Z ",te.push({path:d,color:r,id:o,type:i}),d="M ".concat(e+5," ").concat(c),d+=" Q ".concat(e+5+7+Math.min(7,n)," ").concat(c," ").concat(e+5+7+Math.min(7,n)," ").concat(c+n+7),d+=" H ".concat(e+5+7),d+=" Q ".concat(e+5+7," ").concat(c+n," ").concat(e+5," ").concat(c+n),d+=" Z ",te.push({path:d,color:r,id:o,type:i}),Z[s]+=1}function Ue(e,t,a,n,r,o,s,i){var c=Math.min(t,a),l=Math.max(t,a);e-=10*V[s],ae.push({xStart:e-6,yStart:t,xEnd:e+10*V[s],yEnd:t+n-1,color:r,id:o,type:i}),ae.push({xStart:e-5-7-Math.min(7,n),yStart:c+n+7-1,xEnd:e-5-7-1,yEnd:l-7+1,color:r,id:o,type:i}),ae.push({xStart:e-6,yStart:a,xEnd:e+10*V[s],yEnd:a+n-1,color:r,id:o,type:i});var d="M ".concat(e-5," ").concat(l);d+=" Q ".concat(e-5-7," ").concat(l," ").concat(e-5-7," ").concat(l-7),d+=" H ".concat(e-5-7-Math.min(7,n)),d+=" Q ".concat(e-5-7-Math.min(7,n)," ").concat(l+n," ").concat(e-5," ").concat(l+n),d+=" Z ",te.push({path:d,color:r,id:o,type:i}),d="M ".concat(e-5," ").concat(c),d+=" Q ".concat(e-5-7-Math.min(7,n)," ").concat(c," ").concat(e-5-7-Math.min(7,n)," ").concat(c+n+7),d+=" H ".concat(e-5-7),d+=" Q ".concat(e-5-7," ").concat(c+n," ").concat(e-5," ").concat(c+n),d+=" Z ",te.push({path:d,color:r,id:o,type:i}),V[s]+=1}function _e(e,t,a){"undefined"===typeof a&&(a="haplo");var n=new Set;t.forEach(function(e){n.add(e.color)}),n.forEach(function(n){Qe(t.filter(He("color",n)),a),function(e,t){"undefined"===typeof t&&(t="haplo");e=e.filter(He("type",t)),r.selectAll("trackCorners").data(e).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track".concat(e.id)}).attr("color",function(e){return e.color}).on("mouseover",Ye).on("mouseout",Ve).on("dblclick",Ke)}(e.filter(He("color",n)),a)})}function ze(e,t){r.append("text").attr("x",t).attr("y",oe-13).text("|".concat(e)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","12px").attr("fill","black").style("pointer-events","none")}function He(e,t){return function(a){return a[e]===t}}function Qe(e,t){"undefined"===typeof t&&(t="haplo"),e=e.filter(He("type",t)),r.selectAll("trackRectangles").data(e).enter().append("rect").attr("x",function(e){return e.xStart}).attr("y",function(e){return e.yStart}).attr("width",function(e){return e.xEnd-e.xStart+1}).attr("height",function(e){return e.yEnd-e.yStart+1}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track".concat(e.id)}).attr("color",function(e){return e.color}).on("mouseover",Ye).on("mouseout",Ve).on("dblclick",Ke)}function Xe(e,t){return e[6]<t[6]?-1:e[6]>t[6]?1:0}function We(e){"undefined"===typeof e&&(e="haplo");var t=ee.filter(He("type",e));t.sort(Xe),t.forEach(function(e){var t=(e.xStart+e.xEnd)/2,a="M ".concat(e.xStart," ").concat(e.yStart);a+=" C ".concat(t," ").concat(e.yStart," ").concat(t," ").concat(e.yEnd," ").concat(e.xEnd," ").concat(e.yEnd),a+=" V ".concat(e.yEnd+e.width),a+=" C ".concat(t," ").concat(e.yEnd+e.width," ").concat(t," ").concat(e.yStart+e.width," ").concat(e.xStart," ").concat(e.yStart+e.width),a+=" Z",e.path=a}),r.selectAll("trackCurves").data(ee).enter().append("path").attr("d",function(e){return e.path}).style("fill",function(e){return e.color}).attr("trackID",function(e){return e.id}).attr("class",function(e){return"track".concat(e.id)}).attr("color",function(e){return e.color}).on("mouseover",Ye).on("mouseout",Ve).on("dblclick",Ke)}function Ge(){for(var e='<table class="table-sm table-condensed table-nonfluid"><thead><tr><th>Color</th><th>Trackname</th><th>Show Track</th></tr></thead>',t=[],a=0;a<i.length;a+=1)"haplo"===i[a].type&&(e+='<tr><td style="text-align:right"><div class="color-box" style="background-color: '.concat(Re(i[a],"exon"),';"></div></td>'),i[a].hasOwnProperty("name")?e+="<td>".concat(i[a].name,"</td>"):e+="<td>".concat(i[a].id,"</td>"),e+='<td><input type="checkbox" checked=true id="showTrack'.concat(a,'"></td>'),t.push(a));e+="</table",document.getElementById("legendDiv").innerHTML=e,t.forEach(function(e){document.getElementById("showTrack".concat(e)).addEventListener("click",function(){return function(e){for(var t=0;t<G.length&&G[t].id!==e;)t+=1;t<G.length&&(G[t].hasOwnProperty("hidden")?G[t].hidden=!G[t].hidden:G[t].hidden=!0),de()}(e)},!1)})}function Ye(){var e=A.c(this).attr("trackID");A.d(".track".concat(e)).style("fill","url(#patternA)")}function Je(){A.c(this).style("stroke-width","4px")}function Ve(){var e=A.c(this).attr("trackID");A.d(".track".concat(e)).each(function(){var e=A.c(this).attr("color");A.c(this).style("fill",e)})}function Ze(){A.c(this).style("stroke-width","2px")}function Ke(){for(var e=A.c(this).attr("trackID"),t=0;t<G.length&&G[t].id!==Number(e);)t+=1;t>=G.length||(R&&console.log("moving index: ".concat(t)),function(e){G.unshift(G[e]),G.splice(e+1,1),ie(0)}(t),de())}function $e(){var e=A.c(this).attr("id");K.clickableNodesFlag&&(c&&K.showReads?(document.getElementById("hgvmNodeID").value=e,document.getElementById("hgvmPostButton").click()):(document.getElementById("nodeID").value=e,document.getElementById("postButton").click()))}function et(e){var t=[];return e.node.forEach(function(e){t.push({name:"".concat(e.id),sequenceLength:e.sequence.length,seq:e.sequence})}),t}function tt(){switch(s.forEach(function(e){e.hasOwnProperty("sequenceLength")||(e.sequenceLength=e.seq.length)}),K.nodeWidthOption){case 1:s.forEach(function(e){e.width=1+Math.log(e.sequenceLength)/Math.log(2),e.pixelWidth=Math.round(8.401*(e.width-1))});break;case 2:s.forEach(function(e){e.width=e.sequenceLength/100,e.pixelWidth=Math.round(8.401*(e.width-1))});break;default:s.forEach(function(e){e.width=e.sequenceLength,r.append("text").attr("x",0).attr("y",100).attr("id","dummytext").text(e.seq.substr(1)).attr("font-family",'Courier, "Lucida Console", monospace').attr("font-size","14px").attr("fill","black").style("pointer-events","none"),e.pixelWidth=Math.round(document.getElementById("dummytext").getComputedTextLength()),document.getElementById("dummytext").remove()})}}function at(e){var t=[];return e.path.forEach(function(e,a){var n=[],r=!0;e.mapping.forEach(function(e){e.position.hasOwnProperty("is_reverse")&&!0===e.position.is_reverse?n.push("-".concat(e.position.node_id)):(n.push("".concat(e.position.node_id)),r=!1)}),r&&(n.reverse(),n.forEach(function(e,t){n[t]=e.substr(1)}));var o={};o.id=a,o.sequence=n,e.hasOwnProperty("freq")&&(o.freq=e.freq),e.hasOwnProperty("name")&&(o.name=e.name),e.hasOwnProperty("indexOfFirstBase")&&(o.indexOfFirstBase=Number(e.indexOfFirstBase)),t.push(o)}),t}function nt(e,t,a){R&&(console.log("Reads:"),console.log(a));var n=[],r=[];e.forEach(function(e){r.push(e.name,10)});for(var o=function(e){var o=a[e],s=[],i=[],c=-1,l=-1;if(o.path.mapping.forEach(function(t,a){if(r.indexOf(t.position.node_id)>-1){var n={},o=0;t.position.hasOwnProperty("is_reverse")&&!0===t.position.is_reverse?(s.push("-".concat(t.position.node_id)),n.nodeName="-".concat(t.position.node_id)):(s.push("".concat(t.position.node_id)),n.nodeName=t.position.node_id.toString()),c<0&&(c=a,t.position.hasOwnProperty("offset")&&(t.position.offset=parseInt(t.position.offset,10),o=t.position.offset)),l=a;var d=[],h=o;t.edit.forEach(function(n){n.hasOwnProperty("to_length")&&!n.hasOwnProperty("from_length")?d.push({type:"insertion",pos:h,seq:n.sequence}):!n.hasOwnProperty("to_length")&&n.hasOwnProperty("from_length")?d.push({type:"deletion",pos:h,length:n.from_length}):n.hasOwnProperty("sequence")&&(n.sequence.length>1&&R&&console.log("found substitution at read ".concat(e,", node ").concat(a," = ").concat(t.position.node_id,", seq = ").concat(n.sequence)),d.push({type:"substitution",pos:h,seq:n.sequence})),n.hasOwnProperty("from_length")&&(h+=n.from_length)}),n.mismatches=d,i.push(n)}}),0===s.length)R&&console.log("read ".concat(e," is empty"));else{var d={};d.id=t.length+n.length,d.sequence=s,d.sequenceNew=i,d.type="read",o.path.hasOwnProperty("freq")&&(d.freq=o.path.freq),o.path.hasOwnProperty("name")&&(d.name=o.path.name),d.firstNodeOffset=0,o.path.mapping[c].position.hasOwnProperty("offset")&&(d.firstNodeOffset=o.path.mapping[c].position.offset);var h=o.path.mapping[l].edit;d.finalNodeCoverLength=0,o.path.mapping[l].position.hasOwnProperty("offset")&&(d.finalNodeCoverLength+=o.path.mapping[l].position.offset),h.forEach(function(e){e.hasOwnProperty("from_length")&&(d.finalNodeCoverLength+=e.from_length)}),d.mapping_quality=o.mapping_quality||0,d.is_secondary=o.is_secondary||!1,n.push(d)}},s=0;s<a.length;s+=1)o(s);return n}function rt(e,t,a){if(1!==t[e].length)return!1;if("None"===t[e][0])return!1;var n=t[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var r=h.get(n);return 1===a[r].length&&("None"!==a[r][0]&&n)}function ot(e,t,a){if(1!==a[e].length)return!1;if("None"===a[e][0])return!1;var n=a[e][0];"-"===n.charAt(0)&&(n=n.substr(1));var r=h.get(n);return 1===t[r].length&&"None"!==t[r][0]}function st(){A.c(this).attr("fill","red");var e=Number(A.c(this).attr("x")),t=Number(A.c(this).attr("y")),a=Number(A.c(this).attr("nodeY"));r.append("line").attr("class","insertionHighlight").attr("x1",e+4).attr("y1",t-10).attr("x2",e+4).attr("y2",a+5).attr("stroke-width",1).attr("stroke","black")}function it(){A.c(this).attr("stroke","red");var e=Number(A.c(this).attr("x1")),t=Number(A.c(this).attr("x2")),a=Number(A.c(this).attr("y1")),n=Number(A.c(this).attr("nodeY"));r.append("line").attr("class","deletionHighlight").attr("x1",e).attr("y1",a-3).attr("x2",e).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),r.append("line").attr("class","deletionHighlight").attr("x1",t).attr("y1",a-3).attr("x2",t).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function ct(){A.c(this).attr("fill","red");var e=Number(A.c(this).attr("x")),t=Number(A.c(this).attr("rightX")),a=Number(A.c(this).attr("y")),n=Number(A.c(this).attr("nodeY"));r.append("line").attr("class","substitutionHighlight").attr("x1",e-1).attr("y1",a-7).attr("x2",e-1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black"),r.append("line").attr("class","substitutionHighlight").attr("x1",t+1).attr("y1",a-7).attr("x2",t+1).attr("y2",n+5).attr("stroke-width",1).attr("stroke","black")}function lt(){A.c(this).attr("fill","black"),A.d(".insertionHighlight").remove()}function dt(){A.c(this).attr("stroke","grey"),A.d(".deletionHighlight").remove()}function ht(){A.c(this).attr("fill","black"),A.d(".substitutionHighlight").remove()}var pt=2,ut=function(e){function t(){var e,a;Object(x.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleZoomIn=function(){be(pt)},a.handleZoomOut=function(){be(1/pt)},a.handleDownloadButton=function(){var e=document.getElementById("svg"),t=(new XMLSerializer).serializeToString(e),a=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(a),r=document.createElement("a");r.href=n,r.download="graph.svg",document.body.appendChild(r),r.click(),document.body.removeChild(r)},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return y.a.createElement(q.i,{inline:!0},y.a.createElement(q.l,{className:"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2",for:"nodeID"},"Start:"),y.a.createElement(q.k,{type:"text",className:"custom-input form-control mb-2 mr-sm-4 mb-sm-0",id:"nodeID",size:"12",value:this.props.nodeID,onChange:this.props.handleInputChange}),y.a.createElement(q.l,{className:"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2",for:"distance"},"Length:"),y.a.createElement(q.k,{type:"text",className:"custom-input form-control mb-2 mr-sm-2 mb-sm-0",id:"distance",size:"4",value:this.props.distance,onChange:this.props.handleInputChange}),y.a.createElement(q.l,{className:"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2",for:"unitSelect"},"Unit:"),y.a.createElement(q.k,{type:"select",className:"custom-select mb-2 mr-sm-2 mb-sm-0",id:"byNode",value:this.props.byNode,onChange:this.props.handleInputChange},y.a.createElement("option",{value:"false"},"Nucleotides"),y.a.createElement("option",{value:"true"},"Nodes")),"\xa0",this.props.uploadInProgress&&y.a.createElement("div",{className:"smallLoader",id:"fileUploadSpinner"}),y.a.createElement(q.b,{color:"primary",id:"goButton",onClick:this.props.handleGoButton,disabled:this.props.uploadInProgress},"Go"),y.a.createElement(q.b,{color:"primary",id:"goLeftButton",onClick:this.props.handleGoLeft},y.a.createElement(L.a,{icon:D.c,size:"lg"})),y.a.createElement(q.b,{color:"primary",id:"zoomInButton",onClick:this.handleZoomIn},y.a.createElement(L.a,{icon:D.b,size:"lg"})),y.a.createElement(q.b,{color:"primary",id:"zoomOutButton",onClick:this.handleZoomOut},y.a.createElement(L.a,{icon:D.a,size:"lg"})),y.a.createElement(q.b,{color:"primary",id:"goRightButton",onClick:this.props.handleGoRight},y.a.createElement(L.a,{icon:D.d,size:"lg"})),y.a.createElement(q.b,{color:"secondary",id:"downloadButton",onClick:this.handleDownloadButton},"Download Image"))}}]),t}(m.Component),ft=function(e){function t(){return Object(x.a)(this,t),Object(O.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.xgSelectOptions.map(function(e){return y.a.createElement("option",{value:e,key:e},e)}),t=this.props.gbwtSelectOptions.map(function(e){return y.a.createElement("option",{value:e,key:e},e)}),a=this.props.gamSelectOptions.map(function(e){return y.a.createElement("option",{value:e,key:e},e)}),n=this.props.pathSelectOptions.map(function(e){return y.a.createElement("option",{value:e,key:e},e)});return y.a.createElement(y.a.Fragment,null,y.a.createElement(q.l,{className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"xg file:"),y.a.createElement(q.k,{type:"select",className:"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0",id:"xgSelect",value:this.props.xgSelect,onChange:this.props.handleInputChange},e),y.a.createElement(q.l,{for:"gbwtFileSelect",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"gbwt file:"),y.a.createElement(q.k,{type:"select",className:"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0",id:"gbwtSelect",value:this.props.gbwtSelect,onChange:this.props.handleInputChange},t),y.a.createElement(q.l,{for:"gamFileSelect",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"gam index:"),y.a.createElement(q.k,{type:"select",className:"customDataMounted custom-select mb-2 mr-sm-4 mb-sm-0",id:"gamSelect",value:this.props.gamSelect,onChange:this.props.handleInputChange},a),y.a.createElement(q.l,{for:"pathName",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"Path name:"),y.a.createElement(q.k,{type:"select",className:"customData custom-select mb-2 mr-sm-4 mb-sm-0",id:"pathSelect",value:this.props.pathSelect,onChange:this.props.handleInputChange},n))}}]),t}(m.Component),gt=M.BACKEND_URL||"http://".concat(window.location.host),mt=5242880,yt=function(e){function t(e){var a;return Object(x.a)(this,t),(a=Object(O.a)(this,Object(k.a)(t).call(this,e))).onXgFileChange=function(){var e=a.xgFileInput.current.files[0];if(void 0===e)a.props.resetPathNames(),a.props.handleFileUpload("xgFile","none");else{if(e.size>mt)return a.xgFileInput.current.value="",void a.props.showFileSizeAlert();a.props.setUploadInProgress(!0);var t=new FormData;t.append("xgFile",e);var n=new XMLHttpRequest;n.responseType="json",n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(a.props.setUploadInProgress(!1),a.props.handleFileUpload("xgFile",n.response.path),a.props.getPathNames(n.response.path,"true"))},n.open("POST","".concat(gt,"/xgFileSubmission"),!0),n.send(t)}},a.onGbwtFileChange=function(){var e=a.gbwtFileInput.current.files[0];if(void 0===e)a.props.handleFileUpload("gbwtFile","none");else{if(e.size>mt)return a.gbwtFileInput.current.value="",void a.props.showFileSizeAlert();a.props.setUploadInProgress(!0);var t=new FormData;t.append("gbwtFile",e);var n=new XMLHttpRequest;n.responseType="json",n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(a.props.setUploadInProgress(!1),a.props.handleFileUpload("gbwtFile",n.response.path))},n.open("POST","".concat(gt,"/gbwtFileSubmission"),!0),n.send(t)}},a.onGamFileChange=function(){var e=a.gamFileInput.current.files[0];if(void 0===e)a.props.handleFileUpload("gamFile","none");else{if(e.size>mt)return a.gamFileInput.current.value="",void a.props.showFileSizeAlert();a.props.setUploadInProgress(!0);var t=new FormData;t.append("gamFile",e);var n=new XMLHttpRequest;n.responseType="json",n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(a.props.setUploadInProgress(!1),a.props.handleFileUpload("gamFile",n.response.path))},n.open("POST","".concat(gt,"/gamFileSubmission"),!0),n.send(t)}},a.xgFileInput=y.a.createRef(),a.gbwtFileInput=y.a.createRef(),a.gamFileInput=y.a.createRef(),a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.pathSelectOptions.map(function(e){return y.a.createElement("option",{value:e,key:e},e)});return y.a.createElement(y.a.Fragment,null,y.a.createElement(q.l,{className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"xg file:"),y.a.createElement(q.k,{type:"file",className:"customDataUpload form-control-file",id:"xgFileUpload",accept:".xg",innerRef:this.xgFileInput,onChange:this.onXgFileChange}),y.a.createElement(q.l,{for:"gbwtFileSelect",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"gbwt file:"),y.a.createElement(q.k,{type:"file",className:"customDataUpload form-control-file",id:"gbwtFileUpload",accept:".gbwt",innerRef:this.gbwtFileInput,onChange:this.onGbwtFileChange}),y.a.createElement(q.l,{for:"gamFileSelect",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"gam index:"),y.a.createElement(q.k,{type:"file",className:"customDataUpload form-control-file",id:"gamFileUpload",accept:".gam",innerRef:this.gamFileInput,onChange:this.onGamFileChange}),y.a.createElement(q.l,{for:"pathName",className:"customData tight-label mb-2 mr-sm-2 mb-sm-0 ml-2"},"Path name:"),y.a.createElement(q.k,{type:"select",className:"customData custom-select mb-2 mr-sm-4 mb-sm-0",id:"pathSelect",value:this.props.pathSelect,onChange:this.props.handleInputChange},e))}}]),t}(m.Component),wt=function(e){function t(){var e,a;Object(x.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e,t,n){a.props.setDataOrigin(e),a.props.setColorSetting("haplotypeColors",t),n&&a.props.setColorSetting("forwardReadColors",n)},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this;return y.a.createElement(q.i,{inline:!0},y.a.createElement(q.b,{color:"primary",id:"example1",onClick:function(){return e.handleClick(P.EXAMPLE_1,"plainColors")}},"Indels and Polymorphisms only"),y.a.createElement(q.b,{color:"primary",id:"example2",onClick:function(){return e.handleClick(P.EXAMPLE_2,"plainColors")}},"Inversions"),y.a.createElement(q.b,{color:"primary",id:"example3",onClick:function(){return e.handleClick(P.EXAMPLE_3,"plainColors")}},"Nested Inversions"),y.a.createElement(q.b,{color:"primary",id:"example4",onClick:function(){return e.handleClick(P.EXAMPLE_4,"plainColors")}},"Duplications"),y.a.createElement(q.b,{color:"primary",id:"example5",onClick:function(){return e.handleClick(P.EXAMPLE_5,"plainColors")}},"Translocations"),y.a.createElement(q.b,{color:"primary",id:"example6",onClick:function(){return e.handleClick(P.EXAMPLE_6,"greys","reds")}},"Aligned Reads"))}}]),t}(m.Component),vt=M.BACKEND_URL||"http://".concat(window.location.host),bt=M.DATA_SOURCES,Et={BUILT_IN:"built-in",FILE_UPLOAD:"file-upload",MOUNTED_FILES:"mounted files",EXAMPLES:"examples"},xt=function(e){function t(){var e,a;Object(x.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={xgSelectOptions:["none"],xgSelect:"none",gbwtSelectOptions:["none"],gbwtSelect:"none",gamSelectOptions:["none"],gamSelect:"none",pathSelectOptions:["none"],pathSelect:"none",xgFile:"snp1kg-BRCA1.vg.xg",gbwtFile:"",gamFile:"NA12878-BRCA1.sorted.gam",anchorTrackName:"17",dataPath:"default",nodeID:"1",distance:"100",byNode:"false",dataType:Et.BUILT_IN,fileSizeAlert:!1,uploadInProgress:!1},a.getMountedFilenames=Object(I.a)(N.a.mark(function e(){var t,n;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(vt,"/getFilenames"),{method:"POST",headers:{"Content-Type":"application/json"}});case 3:return t=e.sent,e.next=6,t.json();case 6:(n=e.sent).xgFiles.unshift("none"),n.gbwtFiles.unshift("none"),n.gamIndices.unshift("none"),a.setState(function(e){var t=n.xgFiles.includes(e.xgSelect)?e.xgSelect:"none",a=n.gbwtFiles.includes(e.gbwtSelect)?e.gbwtSelect:"none",r=n.gamIndices.includes(e.gamSelect)?e.gamSelect:"none";return{xgSelectOptions:n.xgFiles,gbwtSelectOptions:n.gbwtFiles,gamSelectOptions:n.gamIndices,xgSelect:t,gbwtSelect:a,gamSelect:r}}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),console.log("POST to /getFilenames failed");case 16:case"end":return e.stop()}},e,this,[[0,13]])})),a.getPathNames=function(){var e=Object(I.a)(N.a.mark(function e(t,n){var r,o;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(vt,"/getPathNames"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({xgFile:t,isUploadedFile:n})});case 3:return r=e.sent,e.next=6,r.json();case 6:o=e.sent,a.setState(function(e){var t=o.pathNames.includes(e.pathSelect)?e.pathSelect:o.pathNames[0];return{pathSelectOptions:o.pathNames,pathSelect:t,anchorTrackName:t}}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log("POST to /getPathNames failed");case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(t,a){return e.apply(this,arguments)}}(),a.resetPathNames=function(){a.setState({pathSelectOptions:["none"],pathSelect:"none"})},a.handleDataSourceChange=function(e){var t=e.target.value;bt.forEach(function(e){e.name!==t||a.setState({xgFile:e.xgFile,gbwtFile:e.gbwtFile,gamFile:e.gamFile,anchorTrackName:e.anchorTrackName,dataPath:e.useMountedPath?"mounted":"default",nodeID:e.defaultPosition,dataType:Et.BUILT_IN})}),"customFileUpload"===t?a.setState(function(e){return{xgFile:e.xgSelect,gbwtFile:e.gbwtSelect,gamFile:e.gamSelect,anchorTrackName:e.pathSelect,dataPath:"upload",dataType:Et.FILE_UPLOAD}}):"customMounted"===t?a.setState(function(e){return{xgFile:e.xgSelect,gbwtFile:e.gbwtSelect,gamFile:e.gamSelect,anchorTrackName:e.pathSelect,dataPath:"mounted",dataType:Et.MOUNTED_FILES}}):"syntheticExamples"===t&&a.setState({dataType:Et.EXAMPLES})},a.handleGoButton=function(){a.props.dataOrigin!==P.API&&(a.props.setColorSetting("haplotypeColors","greys"),a.props.setColorSetting("forwardReadColors","reds"));var e={nodeID:a.state.nodeID,distance:a.state.distance,byNode:a.state.byNode,xgFile:a.state.xgFile,gbwtFile:a.state.gbwtFile,gamFile:a.state.gamFile,anchorTrackName:a.state.anchorTrackName,dataPath:a.state.dataPath};a.props.setFetchParams(e)},a.handleInputChange=function(e){var t=e.target.id,n=e.target.value;a.setState(Object(b.a)({},t,n)),"xgSelect"===t?(a.getPathNames(n,!1),a.setState({xgFile:n})):"gbwtSelect"===t?a.setState({gbwtFile:n}):"gamSelect"===t?a.setState({gamFile:n}):"pathSelect"===t&&a.setState({anchorTrackName:n})},a.handleGoRight=function(){a.setState(function(e){return{nodeID:Number(a.state.nodeID)+Number(a.state.distance)}},function(){return a.handleGoButton()})},a.handleGoLeft=function(){a.setState(function(e){return{nodeID:Math.max(0,Number(a.state.nodeID)-Number(a.state.distance))}},function(){return a.handleGoButton()})},a.handleFileUpload=function(e,t){a.setState(Object(b.a)({},e,t))},a.showFileSizeAlert=function(){a.setState({fileSizeAlert:!0})},a.setUploadInProgress=function(e){a.setState({uploadInProgress:e})},a.setUpWebsocket=function(){a.ws=new WebSocket(vt.replace(/^http/,"ws")),a.ws.onmessage=function(e){a.getMountedFilenames()},a.ws.onclose=function(e){setTimeout(a.setUpWebsocket,1e3)},a.ws.onerror=function(e){a.ws.close()}},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){this.getMountedFilenames(),this.setUpWebsocket()}},{key:"render",value:function(){var e=this,t=bt.map(function(e){return y.a.createElement("option",{value:e.name,key:e.name},e.name)});t.push(y.a.createElement("option",{value:"syntheticExamples",key:"syntheticExamples"},"synthetic data examples"),y.a.createElement("option",{value:"customFileUpload",key:"customFileUpload"},"custom (file upload)"),y.a.createElement("option",{value:"customMounted",key:"customMounted"},"custom (mounted files)"));var a=this.state.dataType===Et.MOUNTED_FILES,n=this.state.dataType===Et.FILE_UPLOAD,r=this.state.dataType===Et.EXAMPLES;return y.a.createElement("div",null,y.a.createElement(q.h,{fluid:!0},y.a.createElement(q.m,null,y.a.createElement(q.f,{md:"auto"},y.a.createElement("img",{src:"./logo.png",alt:"Logo"})),y.a.createElement(q.f,null,y.a.createElement(q.i,{inline:!0},y.a.createElement(q.l,{className:"tight-label mb-2 mr-sm-2 mb-sm-0 ml-2",for:"dataSourceSelect"},"Data:"),y.a.createElement(q.k,{type:"select",id:"dataSourceSelect",className:"custom-select mb-2 mr-sm-4 mb-sm-0",onChange:this.handleDataSourceChange},t),a&&y.a.createElement(ft,{xgSelect:this.state.xgSelect,xgSelectOptions:this.state.xgSelectOptions,gbwtSelect:this.state.gbwtSelect,gbwtSelectOptions:this.state.gbwtSelectOptions,gamSelect:this.state.gamSelect,gamSelectOptions:this.state.gamSelectOptions,pathSelect:this.state.pathSelect,pathSelectOptions:this.state.pathSelectOptions,handleInputChange:this.handleInputChange}),n&&y.a.createElement(yt,{pathSelect:this.state.pathSelect,pathSelectOptions:this.state.pathSelectOptions,handleInputChange:this.handleInputChange,getPathNames:this.getPathNames,resetPathNames:this.resetPathNames,handleFileUpload:this.handleFileUpload,showFileSizeAlert:this.showFileSizeAlert,setUploadInProgress:this.setUploadInProgress})),y.a.createElement(q.a,{color:"danger",isOpen:this.state.fileSizeAlert,toggle:function(){e.setState({fileSizeAlert:!1})},className:"mt-3"},y.a.createElement("strong",null,"File size too big! "),"You may only upload files with a maximum size of"," ","5 MB","."),r?y.a.createElement(wt,{setDataOrigin:this.props.setDataOrigin,setColorSetting:this.props.setColorSetting}):y.a.createElement(ut,{nodeID:this.state.nodeID,distance:this.state.distance,byNode:this.state.byNode,handleInputChange:this.handleInputChange,handleGoLeft:this.handleGoLeft,handleGoRight:this.handleGoRight,handleGoButton:this.handleGoButton,uploadInProgress:this.state.uploadInProgress})))))}}]),t}(m.Component),St=function(e){function t(){var e,a;Object(x.a)(this,t);for(var o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(s)))).createTubeMap=function(){var e;e={svgID:"#svg",nodes:a.props.nodes,tracks:a.props.tracks,reads:a.props.reads},n=e.svgID,r=A.c(e.svgID),W=JSON.parse(JSON.stringify(e.nodes)),G=JSON.parse(JSON.stringify(e.tracks)),Y=e.reads||null,g=e.bed||null,K.clickableNodesFlag=e.clickableNodes||!1,K.hideLegendFlag=e.hideLegend||!1,de(),K.hideLegendFlag||Ge()},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){this.createTubeMap()}},{key:"componentDidUpdate",value:function(){this.createTubeMap()}},{key:"render",value:function(){return y.a.createElement("svg",{id:"svg"})}}]),t}(m.Component),Ot=M.BACKEND_URL||"http://".concat(window.location.host),kt=function(e){function t(){var e,n;Object(x.a)(this,t);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(n=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(o)))).state={isLoading:!0,error:null},n.getRemoteTubeMapData=Object(I.a)(N.a.mark(function e(){var t,a,r,o,s,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({isLoading:!0,error:null}),e.prev=1,e.next=4,fetch("".concat(Ot,"/getChunkedData"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.props.fetchParams)});case 4:return t=e.sent,e.next=7,t.json();case 7:void 0===(a=e.sent).graph?(r=a.error||"Fetching remote data returned error",n.setState({error:r,isLoading:!1})):(o=et(a.graph),s=at(a.graph),i=nt(o,s,a.gam),n.setState({isLoading:!1,nodes:o,tracks:s,reads:i})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.setState({error:e.t0,isLoading:!1});case 14:case"end":return e.stop()}},e,this,[[1,11]])})),n.getExampleData=Object(I.a)(N.a.mark(function e(){var t,r,o,s,i;return N.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({isLoading:!0,error:null}),e.next=3,a.e(1).then(a.bind(null,48));case 3:s=e.sent,t=s.inputNodes,e.t0=n.props.dataOrigin,e.next=e.t0===P.EXAMPLE_1?8:e.t0===P.EXAMPLE_2?10:e.t0===P.EXAMPLE_3?12:e.t0===P.EXAMPLE_4?14:e.t0===P.EXAMPLE_5?16:e.t0===P.EXAMPLE_6?18:23;break;case 8:return r=s.inputTracks1,e.abrupt("break",24);case 10:return r=s.inputTracks2,e.abrupt("break",24);case 12:return r=s.inputTracks3,e.abrupt("break",24);case 14:return r=s.inputTracks4,e.abrupt("break",24);case 16:return r=s.inputTracks5,e.abrupt("break",24);case 18:return i=JSON.parse(s.k3138),t=et(i),r=at(i),o=nt(t,r,n.readsFromStringToArray(s.demoReads)),e.abrupt("break",24);case 23:console.log("invalid data origin type");case 24:n.setState({isLoading:!1,nodes:t,tracks:r,reads:o});case 25:case"end":return e.stop()}},e,this)})),n.readsFromStringToArray=function(e){var t=e.split("\n"),a=[];return t.forEach(function(e){e.length>0&&a.push(JSON.parse(e))}),a},n}return Object(F.a)(t,e),Object(S.a)(t,[{key:"componentDidMount",value:function(){this.getRemoteTubeMapData()}},{key:"componentDidUpdate",value:function(e){this.props.dataOrigin!==e.dataOrigin?this.props.dataOrigin===P.API?this.getRemoteTubeMapData():this.getExampleData():this.props.fetchParams!==e.fetchParams&&this.getRemoteTubeMapData()}},{key:"render",value:function(){var e=this.state,t=e.isLoading,a=e.error;if(a){console.log(a);var n=a.message?a.message:a;return y.a.createElement(q.h,null,y.a.createElement(q.m,null,y.a.createElement(q.a,{color:"danger"},n)))}return t?y.a.createElement(q.h,null,y.a.createElement(q.m,null,y.a.createElement("div",{id:"loaderContainer"},y.a.createElement("div",{id:"loader"})))):y.a.createElement("div",{id:"tubeMapSVG"},y.a.createElement(St,{nodes:this.state.nodes,tracks:this.state.tracks,reads:this.state.reads}))}}]),t}(m.Component),Ft=a(32),Ct=new Map([["colorful","plainColors"],["greyscale","greys"],["reds","reds"],["blues","blues"],["pale colors","lightColors"]]),Nt=function(e){function t(){var e,a;Object(x.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).onChange=function(e){a.props.setColorSetting(a.props.trackType,Ct.get(e.target.value))},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this,t=Array.from(Ct).map(function(t){var a=Object(Ft.a)(t,2),n=a[0],r=a[1];return y.a.createElement(q.f,{xs:"auto",key:n},y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"radio",value:n,checked:e.props.color===r,onChange:e.onChange}),n)))});return y.a.createElement(q.j,{row:!0,className:"mb-1"},y.a.createElement(q.f,{sm:"2"},this.props.rowHeading,":"),t)}}]),t}(m.Component),It=function(e){function t(){var e,a;Object(x.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(O.a)(this,(e=Object(k.a)(t)).call.apply(e,[this].concat(r)))).state={isOpenLegend:!1,isOpenVisualizationOptions:!0},a.toggleLegend=function(e){a.setState({isOpenLegend:!a.state.isOpenLegend}),e.preventDefault()},a.toggleVisOptions=function(e){a.setState({isOpenVisualizationOptions:!a.state.isOpenVisualizationOptions}),e.preventDefault()},a.handleMappingQualityCutoffChange=function(e){a.props.handleMappingQualityCutoffChange(e.target.value)},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=e.visOptions,a=e.toggleFlag,n=Array.from(Array(61).keys()).map(function(e){return y.a.createElement("option",{value:e,key:e},e)});return y.a.createElement(q.h,null,y.a.createElement("div",{id:"accordion"},y.a.createElement(q.c,null,y.a.createElement(q.e,{id:"legendCard"},y.a.createElement("h5",{className:"mb-0"},y.a.createElement("a",{href:"#collapse",onClick:this.toggleLegend},"Legend"))),y.a.createElement(q.g,{isOpen:this.state.isOpenLegend},y.a.createElement(q.d,null,y.a.createElement("div",{id:"legendDiv"})))),y.a.createElement(q.c,null,y.a.createElement(q.e,{id:"visOptionsCard"},y.a.createElement("h5",{className:"mb-0"},y.a.createElement("a",{href:"#collapse",onClick:this.toggleVisOptions},"Visualization Options"))),y.a.createElement(q.g,{isOpen:this.state.isOpenVisualizationOptions},y.a.createElement(q.d,null,y.a.createElement(q.j,null,y.a.createElement("h5",null,"General"),y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.removeRedundantNodes,onChange:function(){return a("removeRedundantNodes")}}),"Remove redundant nodes")),y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.compressedView,onChange:function(){return a("compressedView")}}),"Compressed view")),y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.transparentNodes,onChange:function(){return a("transparentNodes")}}),"Fully transparent nodes"))),y.a.createElement(q.j,null,y.a.createElement("h5",null,"Sequence Reads"),y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.showReads,onChange:function(){return a("showReads")}}),"Show sequence reads")),t.showReads&&y.a.createElement(y.a.Fragment,null,y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.showSoftClips,onChange:function(){return a("showSoftClips")}}),"Show soft clips")),y.a.createElement(q.j,{check:!0},y.a.createElement(q.l,{check:!0},y.a.createElement(q.k,{type:"checkbox",checked:t.colorReadsByMappingQuality,onChange:function(){return a("colorReadsByMappingQuality")}}),"Color reads by mapping quality")),y.a.createElement(q.i,{inline:!0},y.a.createElement(q.l,{className:"mr-sm-2 ",for:"dataSourceSelect"},"Mapping Quality Cutoff:"),y.a.createElement(q.k,{type:"select",id:"dataSourceSelect",className:"custom-select",value:t.mappingQualityCutoff,onChange:this.handleMappingQualityCutoffChange},n)))),y.a.createElement("h5",null,"Colors"),y.a.createElement(q.i,null,y.a.createElement(Nt,{rowHeading:"Haplotypes",color:t.haplotypeColors,trackType:"haplotypeColors",setColorSetting:this.props.setColorSetting}),t.showReads&&!t.colorReadsByMappingQuality&&y.a.createElement(y.a.Fragment,null,y.a.createElement(Nt,{rowHeading:"Reads (forward strand)",color:t.forwardReadColors,trackType:"forwardReadColors",setColorSetting:this.props.setColorSetting}),y.a.createElement(Nt,{rowHeading:"Reads (reverse strand)",color:t.reverseReadColors,trackType:"reverseReadColors",setColorSetting:this.props.setColorSetting}))))))))}}]),t}(m.Component),qt=function(e){function t(e){var a;return Object(x.a)(this,t),(a=Object(O.a)(this,Object(k.a)(t).call(this,e))).setFetchParams=function(e){a.setState({fetchParams:e,dataOrigin:P.API})},a.toggleVisOptionFlag=function(e){a.setState(function(t){return{visOptions:Object(E.a)({},t.visOptions,Object(b.a)({},e,!t.visOptions[e]))}})},a.handleMappingQualityCutoffChange=function(e){a.setState(function(t){return{visOptions:Object(E.a)({},t.visOptions,{mappingQualityCutoff:e})}})},a.setColorSetting=function(e,t){a.setState(function(a){return{visOptions:Object(E.a)({},a.visOptions,Object(b.a)({},e,t))}})},a.setDataOrigin=function(e){a.setState({dataOrigin:e})},a.state={fetchParams:{nodeID:"1",distance:"100",byNode:"false",xgFile:"snp1kg-BRCA1.vg.xg",gbwtFile:"",gamFile:"NA12878-BRCA1.sorted.gam",anchorTrackName:"17",dataPath:"default"},dataOrigin:P.API,visOptions:{removeRedundantNodes:!0,compressedView:!1,transparentNodes:!1,showReads:!0,showSoftClips:!0,haplotypeColors:"greys",forwardReadColors:"reds",reverseReadColors:"blues",colorReadsByMappingQuality:!1,mappingQualityCutoff:0}},a}return Object(F.a)(t,e),Object(S.a)(t,[{key:"componentDidUpdate",value:function(){var e,t=this.state.visOptions;t.compressedView?le(1):le(0),e=t.removeRedundantNodes,K.mergeNodesFlag!==e&&(K.mergeNodesFlag=e,r=A.c(n),de()),function(e){K.transparentNodesFlag!==e&&(K.transparentNodesFlag=e,r=A.c(n),de())}(t.transparentNodes),function(e){K.showReads!==e&&(K.showReads=e,r=A.c(n),de())}(t.showReads),function(e){K.showSoftClips!==e&&(K.showSoftClips=e,r=A.c(n),de())}(t.showSoftClips),ce("haplotypeColors",t.haplotypeColors),ce("forwardReadColors",t.forwardReadColors),ce("reverseReadColors",t.reverseReadColors),function(e){K.colorReadsByMappingQuality!==e&&(K.colorReadsByMappingQuality=e,r=A.c(n),de())}(t.colorReadsByMappingQuality),function(e){K.mappingQualityCutoff!==e&&(K.mappingQualityCutoff=e,void 0!==r&&(r=A.c(n),de()))}(t.mappingQualityCutoff)}},{key:"render",value:function(){return y.a.createElement("div",null,y.a.createElement(xt,{setFetchParams:this.setFetchParams,setDataOrigin:this.setDataOrigin,setColorSetting:this.setColorSetting,dataOrigin:this.state.dataOrigin}),y.a.createElement(kt,{fetchParams:this.state.fetchParams,dataOrigin:this.state.dataOrigin}),y.a.createElement(It,{visOptions:this.state.visOptions,toggleFlag:this.toggleVisOptionFlag,handleMappingQualityCutoffChange:this.handleMappingQualityCutoffChange,setColorSetting:this.setColorSetting}))}}]),t}(m.Component);v.a.render(y.a.createElement(qt,null),document.getElementById("root"))}},[[33,3,2]]]);
//# sourceMappingURL=main.f8e1ba2b.chunk.js.map